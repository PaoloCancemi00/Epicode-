PRIMA QUERY : DATASET

Origine = Folder.Files("C:\Users\paolo\OneDrive\Desktop\Modulo_3\S9_L2\Dataset"),
    #"File nascosti filtrati1" = Table.SelectRows(Origine, each [Attributes]?[Hidden]? <> true),
    #"Richiama funzione personalizzata1" = Table.AddColumn(#"File nascosti filtrati1", "Trasforma file", each #"Trasforma file"([Content])),
    #"Rinominate colonne1" = Table.RenameColumns(#"Richiama funzione personalizzata1", {"Name", "Source.Name"}),
    #"Rimosse altre colonne1" = Table.SelectColumns(#"Rinominate colonne1", {"Source.Name", "Trasforma file"}),
    #"Espansa colonna table1" = Table.ExpandTableColumn(#"Rimosse altre colonne1", "Trasforma file", Table.ColumnNames(#"Trasforma file"(#"File di esempio"))),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Espansa colonna table1",{{"Source.Name", type text}, {"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Modificato tipo",{"Column2", "Column3"}),
    #"Rimosse prime righe" = Table.Skip(#"Rimosse colonne",2),
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"M3S1E2.xlsx", type text}, {"COD PROD", type text}, {"Collaboratore", type text}, {"Regione", type text}, {"Column5", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column8", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Rinominate colonne" = Table.RenameColumns(#"Modificato tipo1",{{"Column5", "Data"}}),
    #"Rimosse colonne1" = Table.RemoveColumns(#"Rinominate colonne",{"Column8", "M3S1E2.xlsx"}),
    #"Sostituito valore" = Table.ReplaceValue(#"Rimosse colonne1",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Sostituito valore1" = Table.ReplaceValue(#"Sostituito valore","  Jack","Jack",Replacer.ReplaceText,{"Prodotto"}),
    #"Ordinate righe" = Table.Sort(#"Sostituito valore1",{{"Prodotto", Order.Descending}}),
    #"Sostituito valore2" = Table.ReplaceValue(#"Ordinate righe","Jack  ","Jack",Replacer.ReplaceText,{"Prodotto"}),
    #"Filtrate righe1" = Table.SelectRows(#"Sostituito valore2", each true),
    #"Ordinate righe1" = Table.Sort(#"Filtrate righe1",{{"COD PROD", Order.Ascending}}),
    #"Sostituito valore3" = Table.ReplaceValue(#"Ordinate righe1","Emilia.Romanga","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore4" = Table.ReplaceValue(#"Sostituito valore3","Emilia-Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore5" = Table.ReplaceValue(#"Sostituito valore4","Emilia.Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe2" = Table.SelectRows(#"Sostituito valore5", each true),
    #"Rinominate colonne2" = Table.RenameColumns(#"Filtrate righe2",{{"Data", "Data ordine"}}),
    #"Aggiunta colonna indice" = Table.AddIndexColumn(#"Rinominate colonne2", "Indice", 0, 1, Int64.Type),
    #"Rimosse colonne2" = Table.RemoveColumns(#"Aggiunta colonna indice",{"Indice"}),
    #"Duplicata colonna" = Table.DuplicateColumn(#"Rimosse colonne2", "Quantità", "Quantità - Copia"),
    #"Rimosse colonne3" = Table.RemoveColumns(#"Duplicata colonna",{"Quantità - Copia"}),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Rimosse colonne3", "Totale", each [Prezzo unitario] * [Quantità]),
    #"Filtrate righe3" = Table.SelectRows(#"Aggiunta colonna personalizzata", each true),
    #"Ordinate righe2" = Table.Sort(#"Filtrate righe3",{{"Collaboratore", Order.Ascending}}),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Ordinate righe2",{{"Totale", type number}}),
    #"Sostituito valore6" = Table.ReplaceValue(#"Modificato tipo2"," ","",Replacer.ReplaceText,{"COD PROD", "Collaboratore", "Regione", "Categoria", "Prodotto"}),
    #"Sostituito valore7" = Table.ReplaceValue(#"Sostituito valore6"," ","",Replacer.ReplaceText,{"COD PROD"}),
    #"Sostituito valore8" = Table.ReplaceValue(#"Sostituito valore7"," ","",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore9" = Table.ReplaceValue(#"Sostituito valore8"," ","",Replacer.ReplaceText,{"Categoria"}),
    #"Sostituito valore10" = Table.ReplaceValue(#"Sostituito valore9"," ","",Replacer.ReplaceText,{"Prodotto"}),
    #"Aggiunta colonna personalizzata1" = Table.AddColumn(#"Sostituito valore10", "Cifre", each Text.Start([Quantità], 4)),
    #"Rimosse colonne4" = Table.RemoveColumns(#"Aggiunta colonna personalizzata1",{"Cifre"}),
    #"Filtrate righe4" = Table.SelectRows(#"Rimosse colonne4", each ([Collaboratore] <> "FoveAnna")),
    #"Ordinate righe3" = Table.Sort(#"Filtrate righe4",{{"Collaboratore", Order.Ascending}}),
    #"Filtrate righe5" = Table.SelectRows(#"Ordinate righe3", each true),
    #"Aggiunta colonna personalizzata2" = Table.AddColumn(#"Filtrate righe5", "Personalizzato", each Text.Start([COD PROD], 4)),
    #"Rimosse colonne5" = Table.RemoveColumns(#"Aggiunta colonna personalizzata2",{"Personalizzato"}),
    #"Aggiunta colonna personalizzata3" = Table.AddColumn(#"Rimosse colonne5", "Personalizzato", each Text.End([COD PROD], 4)),
    #"Rinominate colonne3" = Table.RenameColumns(#"Aggiunta colonna personalizzata3",{{"Personalizzato", "CIFRE"}, {"Collaboratore", "COLLABORATORE"}, {"Regione", "REGIONE"}, {"Data ordine", "DATA ORDINE"}, {"Categoria", "CATEGORIA"}, {"Prodotto", "PRODOTTO"}, {"Prezzo unitario", "PREZZO UNITARIO"}, {"Quantità", "QUANTITÀ"}, {"Totale", "TOTALE"}}),
    #"Aggiunta colonna personalizzata4" = Table.AddColumn(#"Rinominate colonne3", "IVA", each [TOTALE] * 0.22),
    #"Aggiunta colonna personalizzata5" = Table.AddColumn(#"Aggiunta colonna personalizzata4", "Personalizzato", each [CATEGORIA] & " " & [PRODOTTO]),
    Passaggio_1 = Table.RenameColumns(#"Aggiunta colonna personalizzata5",{{"Personalizzato", "CATPROD"}}),
    Passaggio_2 = Table.AddColumn(Passaggio_1, "SE", each if [QUANTITÀ] > 20 then "TROVATO" else "Null"),
    #"Modificato tipo3" = Table.TransformColumnTypes(Passaggio_2,{{"CATPROD", type text}, {"SE", type text}, {"IVA", type number}}),
    #"Testo in maiuscolo" = Table.TransformColumns(#"Modificato tipo3",{{"REGIONE", Text.Upper, type text}})
in
    #"Testo in maiuscolo"


SECONDA QUERY: SECONDA

 Origine = Folder.Files("C:\Users\paolo\OneDrive\Desktop\Modulo_3\S9_L2\Dataset"),
    #"File nascosti filtrati1" = Table.SelectRows(Origine, each [Attributes]?[Hidden]? <> true),
    #"Richiama funzione personalizzata1" = Table.AddColumn(#"File nascosti filtrati1", "Trasforma file", each #"Trasforma file"([Content])),
    #"Rinominate colonne1" = Table.RenameColumns(#"Richiama funzione personalizzata1", {"Name", "Source.Name"}),
    #"Rimosse altre colonne1" = Table.SelectColumns(#"Rinominate colonne1", {"Source.Name", "Trasforma file"}),
    #"Espansa colonna table1" = Table.ExpandTableColumn(#"Rimosse altre colonne1", "Trasforma file", Table.ColumnNames(#"Trasforma file"(#"File di esempio"))),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Espansa colonna table1",{{"Source.Name", type text}, {"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Modificato tipo",{"Column2", "Column3"}),
    #"Rimosse prime righe" = Table.Skip(#"Rimosse colonne",2),
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"M3S1E2.xlsx", type text}, {"COD PROD", type text}, {"Collaboratore", type text}, {"Regione", type text}, {"Column5", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column8", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Rinominate colonne" = Table.RenameColumns(#"Modificato tipo1",{{"Column5", "Data"}}),
    #"Rimosse colonne1" = Table.RemoveColumns(#"Rinominate colonne",{"Column8", "M3S1E2.xlsx"}),
    #"Sostituito valore" = Table.ReplaceValue(#"Rimosse colonne1",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Sostituito valore1" = Table.ReplaceValue(#"Sostituito valore","  Jack","Jack",Replacer.ReplaceText,{"Prodotto"}),
    #"Ordinate righe" = Table.Sort(#"Sostituito valore1",{{"Prodotto", Order.Descending}}),
    #"Sostituito valore2" = Table.ReplaceValue(#"Ordinate righe","Jack  ","Jack",Replacer.ReplaceText,{"Prodotto"}),
    #"Filtrate righe1" = Table.SelectRows(#"Sostituito valore2", each true),
    #"Ordinate righe1" = Table.Sort(#"Filtrate righe1",{{"COD PROD", Order.Ascending}}),
    #"Sostituito valore3" = Table.ReplaceValue(#"Ordinate righe1","Emilia.Romanga","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore4" = Table.ReplaceValue(#"Sostituito valore3","Emilia-Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore5" = Table.ReplaceValue(#"Sostituito valore4","Emilia.Romagna","Emilia Romagna",Replacer.ReplaceText,{"Regione"}),
    #"Filtrate righe2" = Table.SelectRows(#"Sostituito valore5", each true),
    #"Rinominate colonne2" = Table.RenameColumns(#"Filtrate righe2",{{"Data", "Data ordine"}}),
    #"Aggiunta colonna indice" = Table.AddIndexColumn(#"Rinominate colonne2", "Indice", 0, 1, Int64.Type),
    #"Rimosse colonne2" = Table.RemoveColumns(#"Aggiunta colonna indice",{"Indice"}),
    #"Duplicata colonna" = Table.DuplicateColumn(#"Rimosse colonne2", "Quantità", "Quantità - Copia"),
    #"Rimosse colonne3" = Table.RemoveColumns(#"Duplicata colonna",{"Quantità - Copia"}),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Rimosse colonne3", "Totale", each [Prezzo unitario] * [Quantità]),
    #"Filtrate righe3" = Table.SelectRows(#"Aggiunta colonna personalizzata", each true),
    #"Ordinate righe2" = Table.Sort(#"Filtrate righe3",{{"Collaboratore", Order.Ascending}}),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Ordinate righe2",{{"Totale", type number}}),
    #"Sostituito valore6" = Table.ReplaceValue(#"Modificato tipo2"," ","",Replacer.ReplaceText,{"COD PROD", "Collaboratore", "Regione", "Categoria", "Prodotto"}),
    #"Sostituito valore7" = Table.ReplaceValue(#"Sostituito valore6"," ","",Replacer.ReplaceText,{"COD PROD"}),
    #"Sostituito valore8" = Table.ReplaceValue(#"Sostituito valore7"," ","",Replacer.ReplaceText,{"Regione"}),
    #"Sostituito valore9" = Table.ReplaceValue(#"Sostituito valore8"," ","",Replacer.ReplaceText,{"Categoria"}),
    #"Sostituito valore10" = Table.ReplaceValue(#"Sostituito valore9"," ","",Replacer.ReplaceText,{"Prodotto"}),
    #"Aggiunta colonna personalizzata1" = Table.AddColumn(#"Sostituito valore10", "Cifre", each Text.Start([Quantità], 4)),
    #"Rimosse colonne4" = Table.RemoveColumns(#"Aggiunta colonna personalizzata1",{"Cifre"}),
    #"Filtrate righe4" = Table.SelectRows(#"Rimosse colonne4", each ([Collaboratore] <> "FoveAnna")),
    #"Ordinate righe3" = Table.Sort(#"Filtrate righe4",{{"Collaboratore", Order.Ascending}}),
    #"Filtrate righe5" = Table.SelectRows(#"Ordinate righe3", each true),
    #"Aggiunta colonna personalizzata2" = Table.AddColumn(#"Filtrate righe5", "Personalizzato", each Text.Start([COD PROD], 4)),
    #"Rimosse colonne5" = Table.RemoveColumns(#"Aggiunta colonna personalizzata2",{"Personalizzato"}),
    #"Aggiunta colonna personalizzata3" = Table.AddColumn(#"Rimosse colonne5", "Personalizzato", each Text.End([COD PROD], 4)),
    #"Rinominate colonne3" = Table.RenameColumns(#"Aggiunta colonna personalizzata3",{{"Personalizzato", "CIFRE"}, {"Collaboratore", "COLLABORATORE"}, {"Regione", "REGIONE"}, {"Data ordine", "DATA ORDINE"}, {"Categoria", "CATEGORIA"}, {"Prodotto", "PRODOTTO"}, {"Prezzo unitario", "PREZZO UNITARIO"}, {"Quantità", "QUANTITÀ"}, {"Totale", "TOTALE"}}),
    #"Aggiunta colonna personalizzata4" = Table.AddColumn(#"Rinominate colonne3", "IVA", each [TOTALE] * 0.22),
    #"Aggiunta colonna personalizzata5" = Table.AddColumn(#"Aggiunta colonna personalizzata4", "Personalizzato", each [CATEGORIA] & " " & [PRODOTTO]),
    #"Rinominate colonne4" = Table.RenameColumns(#"Aggiunta colonna personalizzata5",{{"Personalizzato", "CATPROD"}}),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Rinominate colonne4", "SE", each if [QUANTITÀ] > 20 then "TROVATO" else "Null"),
    #"Raggruppate righe" = Table.Group(#"Colonna condizionale aggiunta", {"COLLABORATORE"}, {{"RAGGRUPPAMENTO", each List.Sum([QUANTITÀ]), type nullable number}})
in
    #"Raggruppate righe"